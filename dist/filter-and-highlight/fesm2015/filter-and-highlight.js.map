{"version":3,"file":"filter-and-highlight.js","sources":["../../projects/filter-and-highlight/src/lib/filter-and-highlight.component.ts","../../projects/filter-and-highlight/src/lib/filter.pipe.ts","../../projects/filter-and-highlight/src/lib/filter-and-highlight.module.ts"],"sourcesContent":["import {\n  Component,\n  ElementRef,\n  OnInit,\n  ViewChild,\n  Renderer2,\n  Input,\n  ViewEncapsulation,\n  AfterContentInit,\n  AfterViewInit,\n} from '@angular/core';\n\n@Component({\n  selector: 'fah-filter-and-highlight',\n  template: `\n    <div #content [hidden]=\"true\">\n      <ng-content></ng-content>\n    </div>\n\n    <div [innerHTML]=\"highlightedContent\" #highlightContent></div>\n  `,\n  styles: [\n    `\n      .fah-mark {\n        background-color: yellow;\n        font-weight: normal;\n      }\n    `,\n  ],\n  encapsulation: ViewEncapsulation.None,\n})\nexport class FilterAndHighlightComponent implements OnInit, AfterViewInit {\n  @ViewChild('content', { static: true }) content: ElementRef;\n  @ViewChild('highlightContent', { static: false })\n  highlightContent: ElementRef;\n\n  @Input('options') options;\n\n  initialContent: ElementRef;\n\n  highlightedContent: any;\n  searchTerm: string;\n\n  constructor(private renderer: Renderer2) {}\n\n  ngOnInit() {\n    const self = this;\n    const fahInputs: any = document.getElementsByClassName('fah-input');\n\n    let minLen = 1\n\n    if (this.options != null && 1){\n      minLen = 1;\n    }\n\n    for (const input of fahInputs) {\n      (input as HTMLElement).onkeyup = (e: any) => {\n        if (e.target.value.length > minLen) {\n          this.markText(e);\n        } else {\n          this.renderNewHTML();\n        }\n      };\n    }\n    this.initialContent = this.content;\n  }\n\n  ngAfterViewInit() {\n    this.renderNewHTML();\n  }\n\n  \n  /**\n   * This function replaces innerHTML with marked HTML. \n   */\n  private renderNewHTML(){\n    this.renderer.setProperty(\n      this.highlightContent.nativeElement,\n      'innerHTML',\n      this.initialContent.nativeElement.innerHTML\n    );\n    this.adjustStyles();\n  }\n\n  /**\n   * This function will replace innerHTML and apply spans to text that matches search input.\n   * \n   * @param e The keyboard input\n   */\n\n  private markText(e: any) {\n    const searchInput: any = document.activeElement;\n    this.searchTerm = searchInput.value;\n    let term = this.searchTerm;\n\n    this.highlightContent.nativeElement.innerHTML = this.initialContent.nativeElement.innerHTML;\n\n    term = term.replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\n\n    const re = '(?<!</?[^>]*|&[^;]*)(' + term + ')';\n\n    try {\n      this.highlightContent.nativeElement.innerHTML = this.initialContent.nativeElement.innerHTML.replace(\n        new RegExp(re, 'gi'),\n        '<span class=\\'fah-mark\\'>$1</span>'\n      );\n    } catch (e) {}\n    this.adjustStyles();\n  }\n\n  /**\n   * This function will apply the styles from the options object.\n   */\n\n  private adjustStyles() {\n    const elems: any = document.getElementsByClassName('fah-mark');\n\n    for (const elem of elems) {\n      elem.style.backgroundColor = this.options.backgroundColor;\n      elem.style.color = this.options.textColor;\n      elem.style.fontWeight = this.options.fontWeight;\n      elem.style.padding = this.options.padding;\n      elem.style.border = this.options.border;\n      elem.style.borderRadius = this.options.borderRadius;\n    }\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'filter',\n})\n\nexport class FilterPipe implements PipeTransform {\n\n  /**\n   *\n   * @param objects array of objects which will be filtered\n   * @param input term used in search\n   * @param isNumber whether object is strictly a number array\n   */\n\n  transform(objects: any, input: string, isNumber: boolean = false): any {\n\n    let inputNum: number;\n\n    if (!input || !objects) {\n      return objects;\n    }else{\n      if(isNumber){\n        inputNum = parseInt(input, 10);\n        return this.checkItems(objects, inputNum, isNumber);\n      }\n      input.replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\n      return this.checkItems(objects, input);\n    }\n  }\n  \n  /**\n   *\n   * @param objects list of items from array\n   * @param input term used to filter items\n   * @param isNumber whether array consists of numbers only\n   */\n  \n  private checkItems(objects: any, input: any, isNumber?: boolean) {\n    let comp = input;\n    \n    if(!isNumber){\n      comp = input.toLowerCase();\n    }\n    \n    function checkItem(obj: any, inp: string | number){\n      if (typeof obj === 'string' && obj.toString().toLowerCase().includes(comp)) {\n        return true;\n      }else if(typeof obj === 'number' && obj.toString().includes(comp)){\n        return true;\n      }else{\n        for (const property in obj) {\n          if (obj[property] === null || obj[property] === undefined) {\n            continue;\n          }\n          if (typeof obj[property] === 'object') {\n            if(Array.isArray(obj[property])){\n              // Future feature?\n              for(const subObj in obj[property]){\n                if(checkItem(subObj, inp)){\n                  return true;\n                }\n              }\n            }\n            if (checkItem(obj[property], inp)) {\n              return true;\n            }\n          } else if (obj[property].toString().toLowerCase().includes(comp)) {\n            return true;\n          }\n        }\n      }\n      \n    }\n    \n    return objects.filter(obj => {\n      return checkItem(obj, input);\n    });\n  }\n}\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { FilterAndHighlightComponent } from './filter-and-highlight.component';\nimport { FilterPipe } from './filter.pipe';\n\n@NgModule({\n  declarations: [FilterAndHighlightComponent, FilterPipe],\n  imports: [],\n  exports: [FilterAndHighlightComponent, FilterPipe],\n})\nexport class FilterAndHighlightModule {}\n"],"names":[],"mappings":"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"}